:_mod-docs-content-type: PROCEDURE
[id="nw-metallb-configure-address-pool_{context}"]
= Viewing IPAddressPool

[role="_abstract"]
You can monitor IP address allocation from your MetalLB pools by viewing the IPAddressPool status, which shows how many addresses are assigned to services and how many remain available for assignment.

As a cluster administrator, you can add address pools to your cluster to control the IP addresses that MetalLB can assign to load-balancer services. This worked example shows how to create an `IPAddressPool` custom resource (CR) and view its status. The advertisement mode is set to L2. 

.Prerequisites

* You have an {product-title} cluster with the MetalLB Operator installed.
* You have created a MetalLB instance. For example:
+
[source,yaml]
----
apiVersion: metallb.io/v1beta1
kind: MetalLB
metadata:
  name: metallb
  namespace: metallb-system
spec: {}
----
+
This deploys the MetalLB controller and speaker pods required for status monitoring.

.Procedure

The `IPAddressPool` CR's status section provides details about IP address allocation from a specific pool.

.Procedure

. Create an IP address pool.

.. Create a file, such as `ipaddresspool.yaml`, with content like the following example:
+
[source,yaml]
----
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: doc-example-l2
  namespace: metallb-system
spec:
  addresses:
  - 192.168.122.200-192.168.122.220
  autoAssign: true
  avoidBuggyIPs: false
----

.. Apply the configuration for the IP address pool:
+
[source,terminal]
----
$ oc apply -f ipaddresspool.yaml
----

. View the status of the IP address pool by running the following command:
+
[source,terminal]
----
$ oc get ipaddresspool doc-example-l2 -n metallb-system -o yaml
----
+
The output is similar to the following:
+
[source,yaml]
----
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"metallb.io/v1beta1","kind":"IPAddressPool","metadata":{"annotations":{},"name":"doc-example-l2","namespace":"metallb-system"},"spec":{"addresses":["192.168.122.200-192.168.122.220"],"autoAssign":true,"avoidBuggyIPs":false}}
  creationTimestamp: "2025-07-17T10:13:37Z"
  generation: 1
  name: doc-example-l2
  namespace: metallb-system
  resourceVersion: "29080"
  uid: 8df1c303-03ac-4d31-8970-6dacdb173dc2
spec:
  addresses:
  - 192.168.122.200-192.168.122.220
  autoAssign: true
  avoidBuggyIPs: false
status:
  assignedIPv4: 0
  assignedIPv6: 0
  availableIPv4: 21
  availableIPv6: 0
----
+
The `status` section includes the following fields:
+
* `assignedIPv4` represents the total number of IPv4 addresses that have been successfully assigned by MetalLB from this pool to LoadBalancer services.
* `assignedIPv6` represents the total number of IPv6 addresses that have been successfully assigned by MetalLB from this pool to LoadBalancer services.
* `availableIPv4` indicates the total number of IPv4 addresses remaining and available for assignment within this pool. This value is calculated by subtracting `assignedIPv4` from the total theoretical IPv4 addresses in the `spec.addresses` ranges, potentially accounting for `avoidBuggyIPs` if enabled.
* `availableIPv6` indicates the total number of IPv6 addresses remaining and available for assignment within this pool. This value is calculated similarly to `availableIPv4`, based on the total theoretical IPv6 addresses in the `spec.addresses` ranges.

. Create a L2Advertisement for Layer 2 mode with the following sample YAML:
+
[source,yaml]
----
apiVersion: metallb.io/v1beta1
kind: L2Advertisement
metadata:
  name: l2advertisement
  namespace: metallb-system
spec:
  ipAddressPools:
  - doc-example-l2
----

.. Apply the configuration for the L2 advertisement:
+
[source,terminal]
----
$ oc apply -f l2advertisement.yaml
----

. Deploy an application and expose it with a LoadBalancer service.

.. Create a file, such as `nginx.yaml`, with the following content to deploy an Nginx application:
+
[source,yaml]
----
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 2
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
----    

.. Apply the configuration by running the following command:
+
[source,terminal]
----
$ oc apply -f nginx.yaml
----

.. Expose the deployment as a LoadBalancer service by creating a file, such as `nginx-service.yaml`, with content like the following:
+
[source,yaml]
----
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
  namespace: default
  annotations:
    metallb.universe.tf/address-pool: doc-example-l2
spec:
  selector:
    app: nginx
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
  type: LoadBalancer
----
+
[IMPORTANT]
====
The service must be in the same namespace as your application deployment. The `metallb.universe.tf/address-pool` annotation tells MetalLB which IPAddressPool to use for IP allocation.
====

.. Apply the service configuration by running the following command:
+
[source,terminal]
----
$ oc apply -f nginx-service.yaml
----

. View the updated `IPAddressPool` status to see the assigned and available IP addresses by running the following command:
+
[source,terminal]
----
$ oc get ipaddresspool doc-example-l2 -n metallb-system -o yaml
----
+
The output is similar to the following:
+
[source,yaml]
----
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"metallb.io/v1beta1","kind":"IPAddressPool","metadata":{"annotations":{},"name":"doc-example-l2","namespace":"metallb-system"},"spec":{"addresses":["192.168.122.200-192.168.122.220"],"autoAssign":true,"avoidBuggyIPs":false}}
  creationTimestamp: "2025-07-17T10:13:37Z"
  generation: 1
  name: doc-example-l2
  namespace: metallb-system
  resourceVersion: "30250"
  uid: 8df1c303-03ac-4d31-8970-6dacdb173dc2
spec:
  addresses:
  - 192.168.122.200-192.168.122.220
  autoAssign: true
  avoidBuggyIPs: false
status:
  assignedIPv4: 1
  assignedIPv6: 0
  availableIPv4: 20
  availableIPv6: 0
----
+
The `assignedIPv4` value of `1` indicates that one IPv4 address from this pool has been successfully assigned by MetalLB to your `nginx-service` LoadBalancer, confirming that MetalLB has allocated an IP and it is in use.
