// Module included in the following assemblies:
//
// * networking/metallb/monitoring-metallb-status.adoc

:_mod-docs-content-type: PROCEDURE
[id="nw-metallb-configuration-state_{context}"]
= Viewing ConfigurationState

[role="_abstract"]
You can view the ConfigurationState custom resource to quickly identify configuration errors in your MetalLB deployment without reviewing component logs. This helps you troubleshoot issues with global settings and node-specific configurations.

The ConfigurationState Custom Resource (CR) provides a clear, top-level indicator of the health of your MetalLB configuration across all components. It is designed to surface configuration errors that originate from user input, making them easy to spot without needing to dig through component logs.

== Key Concepts

MetalLB creates one ConfigurationState resource for the Controller and one for each Speaker running on your nodes.

Controller Status:: Tracks configuration errors related to global settings, primarily IPAddressPool conflicts (e.g., overlapping CIDRs).

Speaker Status:: Tracks configuration errors specific to the node it's running on, such as transient errors related to BGP (e.g., referencing a BFD profile or secret that does not exist yet).

.Prerequisites

* You have an {product-title} cluster with the MetalLB Operator installed.
* You have at least one MetalLB Custom Resource (CR) instance created.

.Procedure

. View the status of all ConfigurationState CRs.
+
Run the following command to see a summary of all component statuses:
+
[source,terminal]
----
$ oc get configurationstates -n metallb-system
----
+
The output is similar to the following when the configuration is healthy:
+
[source,terminal]
----
NAME                    RESULT    LASTERROR   AGE
controller              Valid                 5m
speaker-kind-worker     Valid                 5m
speaker-kind-worker2    Valid                 5m
----

. View the details for a specific ConfigurationState CR.
+
To inspect the status of the controller or a specific speaker, use the name of the resource.

.. Controller Status Check (Example of an error):
+
[source,terminal]
----
$ oc get configurationstate controller -n metallb-system -o yaml
----
+
The output is similar to the following when the configuration is invalid:
+
[source,yaml]
----
apiVersion: metallb.io/v1beta1
kind: ConfigurationState
metadata:
  name: controller
  namespace: metallb-system
  labels:
    metallb.io/component-type: controller
status:
  result: "Invalid"
  lastError: "failed to parse configuration: CIDR \"192.168.10.100/32\" in pool \"client2-pool\" overlaps with already defined CIDR \"192.168.10.0/24\""
----

.. Speaker Status Check (Example of an error):
+
[source,terminal]
----
$ oc get configurationstate speaker-kind-worker2 -n metallb-system -o yaml
----
+
The output is similar to the following when the speaker configuration is invalid:
+
[source,yaml]
----
apiVersion: metallb.io/v1beta1
kind: ConfigurationState
metadata:
  name: speaker-kind-worker2
  namespace: metallb-system
  labels:
    metallb.io/component-type: speaker
    metallb.io/node-name: kind-worker2
status:
  result: "Invalid"
  lastError: "peer peer1 referencing non existing bfd profile my-bfd-profile"
----

The status section reports the current validation state using the following fields:

|===
|Field |Type |Description

|result
|string
|Indicates the configuration validation outcome. Possible values are: Valid (configuration is successfully applied), Invalid (configuration has errors that need user intervention), or Unknown (component is initializing or not reporting state).

|lastError
|string
|Contains a detailed error message from the last configuration failure. This field is empty when result is Valid.
|===

== Troubleshooting Configuration Errors

This CR is most valuable for identifying two main types of user errors:

Direct Validation Errors (Fix required):: Errors where the configuration is fundamentally incorrect (e.g., overlapping IP ranges in a pool, or a BGP secret exists but has the wrong type).

Transient Errors (Self-resolving):: Errors that occur because one resource references another that has not yet been fully created. For example, if a BGPPeer references a BFDProfile that you have not applied yet, the ConfigurationState will initially show Invalid. This error automatically resolves when the missing resource is created.
