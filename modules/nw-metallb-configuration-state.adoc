// Module included in the following assemblies:
//
// * networking/metallb/monitoring-metallb-status.adoc

:_mod-docs-content-type: PROCEDURE
[id="nw-metallb-configuration-state_{context}"]
= Viewing ConfigurationState

[role="_abstract"]
The `ConfigurationState` custom resource (CR) enables quick identification of configuration errors in the MetalLB deployment. The CR surfaces errors originating from user input and provides a top-level indicator of the MetalLB configuration health across all components, eliminating the need to review component logs.

MetalLB creates one `ConfigurationState` CR for the `controller` and one for each `speaker` running on the cluster nodes.

Controller Status:: Tracks configuration errors related to global settings. Errors include, for example, `IPAddressPool` conflicts such as overlapping CIDRs.

Speaker Status:: Tracks configuration errors specific to the node where the `speaker` is running. Errors include, for example, transient errors related to BGP, such as referencing a BFD profile or a secret that does not yet exist.

.Prerequisites

* You have an {product-title} cluster with the MetalLB Operator installed.
* You have at least one MetalLB Custom Resource (CR) instance created.

.Procedure

. Run the following command to see a summary of all `ConfigurationState` component statuses:
+
[source,terminal]
----
$ oc get configurationstates -n metallb-system
----
+
A healthy configuration produces output similar to the following example:
+
[source,terminal]
----
NAME                    RESULT    LASTERROR   AGE
controller              Valid                 5m
speaker-kind-worker     Valid                 5m
speaker-kind-worker2    Valid                 5m
----

. Inspect the status of the `controller` or a specific `speaker`, by using the resource name.

.. Run the following command to check the `controller` status:
+
[source,terminal]
----
$ oc get configurationstate controller -n metallb-system -o yaml
----
+
The following example output indicates an invalid `controller` configuration:
+
[source,yaml]
----
apiVersion: metallb.io/v1beta1
kind: ConfigurationState
metadata:
  name: controller
  namespace: metallb-system
  labels:
    metallb.io/component-type: controller
status:
  result: "Invalid"
  lastError: "failed to parse configuration: CIDR \"192.168.10.100/32\" in pool \"client2-pool\" overlaps with already defined CIDR \"192.168.10.0/24\""
----

.. Run the following command to check a specific `speaker` status, replacing `speaker-kind-worker2` with the name of the target resource:
+
[source,terminal]
----
$ oc get configurationstate speaker-kind-worker2 -n metallb-system -o yaml
----
+
The following example output indicates an invalid `speaker` configuration:
+
[source,yaml]
----
apiVersion: metallb.io/v1beta1
kind: ConfigurationState
metadata:
  name: speaker-kind-worker2
  namespace: metallb-system
  labels:
    metallb.io/component-type: speaker
    metallb.io/node-name: kind-worker2
status:
  result: "Invalid"
  lastError: "peer peer1 referencing non existing bfd profile my-bfd-profile"
----
+
The status section reports the current validation state using the following fields:
+
|===
|Field |Type |Description

|result
|string
|Indicates the configuration validation outcome. Possible values are: `Valid` (configuration is successfully applied), `Invalid` (configuration has errors that need user intervention), or `Unknown` (component is initializing or not reporting state).

|lastError
|string
|Contains a detailed error message from the last configuration failure. This field is empty when result is Valid.
|===

This `ConfigurationState` CR is most valuable for identifying two main types of user errors:

Direct Validation Errors (Fix required):: Errors where the configuration is fundamentally incorrect for example overlapping IP ranges in a pool, or a BGP secret exists but has the wrong type.

Transient Errors (Self-resolving):: Errors that occur because one resource references another that has not yet been fully created. For example, if a BGPPeer references a BFDProfile that you have not applied yet, the ConfigurationState will initially show Invalid. This error automatically resolves when the missing resource is created.
