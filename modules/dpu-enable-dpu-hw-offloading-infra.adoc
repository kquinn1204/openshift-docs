// Module included in the following assemblies:
//CC-3 (alongside 4.10 dev preview)
// * hardware_enablement/dpu-hardware-offload.adoc

:_content-type: PROCEDURE
[id="enabling-hardware-offloading-infra_{context}"]
= Configuring support for hardware offloading in the infrastructure cluster

Configure support for hardware offloading in the infrastructure cluster by using this procedure.

.Prerequisites

* Install the OpenShift CLI (`oc`).
* Log in as a user with `cluster-admin` privileges.

.Procedure

. Create the following OVNKubeConfig custom resource (CR) with the poolName `dpu`, leaving the `kubeConfigFile` blank. Save the YAML in the `ovnkubeconfig.yaml` file:
+
[source,yaml]
----
apiVersion: dpu.openshift.io/v1alpha1
kind: OVNKubeConfig
metadata:
  name: ovnkubeconfig-sample
  namespace: tenantcluster-dpu
spec:
  poolName: dpu
  nodeSelector:
    matchLabels:
      node-role.kubernetes.io/dpu-worker: ""
----

.. Run the following command:
+
[source,terminal]
----
$ oc create -f ovnkubeconfig.yaml
----
+
The DPU Network Operator creates a custom MachineConfigPool and a custom MachineConfig.

. Get the node names by using the following command:
+
[source,terminal]
----
$ oc get nodes
----

. Label the DPU nodes in the infrastructure cluster. The Machine Config Operator applies the new MachineConfig to the DPU nodes, therefore enabling `switchdev` mode on them:
+
[source,terminal]
----
$ oc label node <NODENAME> node-role.kubernetes.io/dpu-worker=
----

. Create a Cluster Network Operator (CNO) ConfigMap in the infrastructure cluster setting the mode to DPU. Save the YAML in the `ovnkubeconfigmap.yaml` file:
+
[source,yaml]
----
apiVersion: v1
kind: ConfigMap
metadata:
    name: dpu-mode-config
    namespace: openshift-network-operator
data:
    mode: "dpu"
immutable: true
----

.. Run the following command:
+
[source,terminal]
----
$ oc create -f ovnkubeconfigmap.yaml
----

. Label the DPU nodes in the infrastructure cluster where you want to enable hardware offloading.
+
[source,terminal]
----
$ oc label node <NODENAME> network.operator.openshift.io/dpu=
----