// Module included in the following assemblies:
//
// * networking/metallb/monitoring-metallb-status.adoc

:_mod-docs-content-type: REFERENCE
[id="nw-metallb-status-troubleshooting_{context}"]
= Troubleshooting MetalLB status monitoring

This section describes common issues with MetalLB status monitoring and how to resolve them.

== ServiceBGPStatus not appearing

If `oc get servicebgpstatus -n metallb-system` shows no resources, verify the following:

* Your service has ready endpoints. MetalLB only advertises services with at least one ready endpoint. Check the endpoints:
+
[source,terminal]
----
$ oc get endpoints <service-name> -n <namespace>
----
+
If the `ENDPOINTS` column is empty, your pods are not ready. Check pod status and ensure the application is running correctly.

* BGPPeer and BGPAdvertisement are configured. Verify you have created both resources:
+
[source,terminal]
----
$ oc get bgppeer -n metallb-system
$ oc get bgpadvertisement -n metallb-system
----

* The MetalLB speaker pod is running on the node. Check speaker pod status:
+
[source,terminal]
----
$ oc get pods -n metallb-system -l component=speaker
----

* BGP session is established. Check speaker logs for BGP session establishment:
+
[source,terminal]
----
$ oc logs -n metallb-system -l component=speaker --tail=50 | grep bgp
----

== ServiceL2Status not appearing

ServiceL2Status resources are only created when using Layer 2 mode with L2Advertisement. If no resources appear:

* Verify you have created an L2Advertisement referencing your IPAddressPool:
+
[source,terminal]
----
$ oc get l2advertisement -n metallb-system
----

* Ensure your service has ready endpoints, similar to the BGP case above.

== IPAddressPool status shows 0 available addresses

If your IPAddressPool shows `availableIPv4: 0` or `availableIPv6: 0`, check the following:

* All addresses have been assigned to services. List services using the pool:
+
[source,terminal]
----
$ oc get svc --all-namespaces -o wide | grep LoadBalancer
----

* The address range in your IPAddressPool spec is correct. Review the pool configuration:
+
[source,terminal]
----
$ oc get ipaddresspool <pool-name> -n metallb-system -o yaml
----

* Look for overlapping IP ranges in multiple pools. Check ConfigurationState for errors:
+
[source,terminal]
----
$ oc get configurationstate controller -n metallb-system -o yaml
----

== Service not receiving an IP address

If your LoadBalancer service remains in `<pending>` state:

* Verify MetalLB instance is deployed and pods are running:
+
[source,terminal]
----
$ oc get metallb -n metallb-system
$ oc get pods -n metallb-system
----

* Check that your service is configured to use an available IPAddressPool. If using an annotation, verify the pool name is correct:
+
[source,terminal]
----
$ oc get svc <service-name> -n <namespace> -o yaml | grep metallb.universe.tf/address-pool
----

* Review the MetalLB controller logs for allocation errors:
+
[source,terminal]
----
$ oc logs -n metallb-system deployment/controller
----
