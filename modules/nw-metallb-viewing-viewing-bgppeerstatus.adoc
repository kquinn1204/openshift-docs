:_mod-docs-content-type: PROCEDURE
[id="nw-viewing-service-bgp-status_{context}"]
= Viewing ServiceBGPStatus

[role="_abstract"]
You can verify BGP advertisement status for your services by viewing the ServiceBGPStatus custom resource, which shows which BGP peers are receiving advertisements from each node. This is essential for debugging connectivity in Telco environments.

The ServiceBGPStatus CR provides insights into which BGP peers a specific service is being advertised to from a given node. This is a crucial tool for network administrators in Telco environments to verify BGP advertisement and debug connectivity.

[NOTE]
====
ServiceBGPStatus resources are created in the `metallb-system` namespace, not in the namespace where your LoadBalancer service is deployed. Always query these resources with `-n metallb-system`.
====

== Example: BGP configuration setup

This example shows how to configure MetalLB for BGP mode to enable ServiceBGPStatus monitoring. You need to create an IPAddressPool, configure a BGPPeer to connect to your BGP router, and create a BGPAdvertisement to control which pools are advertised.

. Create an IPAddressPool for BGP:
+
[source,yaml]
----
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: bgp-pool
  namespace: metallb-system
spec:
  addresses:
  - 192.168.122.210-192.168.122.220
  autoAssign: true
----

. Configure a BGPPeer to connect to your BGP router:
+
[source,yaml]
----
apiVersion: metallb.io/v1beta2
kind: BGPPeer
metadata:
  name: bgp-peer
  namespace: metallb-system
spec:
  myASN: 64501
  peerASN: 64500
  peerAddress: 192.168.1.1  # Replace with your BGP router IP
----

. Create a BGPAdvertisement to advertise the pool:
+
[source,yaml]
----
apiVersion: metallb.io/v1beta1
kind: BGPAdvertisement
metadata:
  name: bgp-advertisement
  namespace: metallb-system
spec:
  ipAddressPools:
  - bgp-pool
----

. Deploy a LoadBalancer service. ServiceBGPStatus resources are created automatically when the service has ready endpoints and begins BGP advertisement.

.Prerequisites

* You have an {product-title} cluster with the MetalLB Operator installed.
* You have created a MetalLB instance. For example:
+
[source,yaml]
----
apiVersion: metallb.io/v1beta1
kind: MetalLB
metadata:
  name: metallb
  namespace: metallb-system
spec: {}
----
+
This deploys the MetalLB controller and speaker pods required for status monitoring.

.Expected behavior

When you deploy a LoadBalancer service with BGP configuration, the following occurs:

. MetalLB assigns an IP address from the configured IPAddressPool.
. The service must have at least one ready endpoint (running pod) before BGP advertisement begins.
. The MetalLB speaker creates a ServiceBGPStatus resource in the `metallb-system` namespace.
. The status shows which BGP peers are receiving advertisements for this service.
. One ServiceBGPStatus resource is created per node that is advertising the service.

.Procedure

. View the status of the ServiceBGPStatus CR by running the following command:
+
[source,terminal]
----
$ oc get ServiceBGPStatus -n metallb-system
----
+
The output is similar to the following:
+
[source,terminal]
----
NAME                  LABELS                                                   AGE
nginx-service-worker0 metallb.io/node=worker0,metallb.io/service=nginx-service 5h
----
+
[NOTE]
====
ServiceBGPStatus resources are created with generated names (for example, `bgp-xxxxx`). Use labels to find the status for your service:

[source,terminal]
----
$ oc get servicebgpstatus -n metallb-system -l metallb.io/service-name=<your-service-name>
----
====

. View the details of the ServiceBGPStatus CR for your service:
+
[source,terminal]
----
$ oc get servicebgpstatus nginx-service-worker0 -n metallb-system -o yaml
----
+
The output is similar to the following:
+
[source,yaml]
----
apiVersion: metallb.io/v1beta1
kind: ServiceBGPStatus
metadata:
  name: service1-worker0
  namespace: metallb-system
  labels:
    metallb.io/node: worker0
    metallb.io/service-name: service1
    metallb.io/service-namespace: servicenamespace
status:
  node: worker0
  peers:
  - peerA
  - peerB
  serviceName: service1
  serviceNamespace: servicenamespace
----
+
The output includes the following important fields:
+
* `metadata.labels.metallb.io/node` indicates the node that is advertising the service via BGP.
* `metadata.labels.metallb.io/service-name` identifies the service being advertised.
* `metadata.labels.metallb.io/service-namespace` identifies the namespace of the service being advertised.
* `status.node` confirms the name of the node advertising the service.
* `status.peers` lists the names of the BGPPeer resources to which the service is being advertised. This is useful for confirming that the advertisement is reaching the intended peers.
* `status.serviceName` indicates the name of the service being advertised.
* `status.serviceNamespace` indicates the namespace of the service being advertised.

== Verifying BGP session establishment

After creating BGP configuration, you can verify that the BGP session is established and routes are being advertised.

. Check FRRNodeState to see the BGP configuration on each node:
+
[source,terminal]
----
$ oc get frrnodestate -n metallb-system
----
+
.Example output
+
[source,terminal]
----
NAME                 AGE
worker0.example.com  5m
----

. View the detailed BGP configuration and running state:
+
[source,terminal]
----
$ oc get frrnodestate worker0.example.com -n metallb-system -o yaml
----
+
The `status.runningConfig` field shows the FRR BGP configuration including configured BGP neighbors, route advertisements, and prefix lists.

. Verify routes are being advertised by checking the FRRNodeState:
+
[source,terminal]
----
$ oc get frrnodestate <node-name> -n metallb-system -o jsonpath='{.status.runningConfig}' | grep "network"
----
+
.Example output
+
[source,terminal]
----
 address-family ipv4 unicast
  network 192.168.122.210/32
----
+
This confirms that the service IP is being advertised via BGP.
