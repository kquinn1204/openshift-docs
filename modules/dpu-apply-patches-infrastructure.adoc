// Module included in the following assemblies:
//
// * hardware_enablement/dpu-hardware-offload.adoc

:_content-type: PROCEDURE
[id="dpu-apply-patches-infrastructure_{context}"]
= Disabling DNS, the Ingress Controller, and monitoring on the worker nodes

Apply the following commands to disable the DNS, Ingress Operator and monitoring on the infrastructure worker nodes.

.Prerequisites

* Install the OpenShift CLI (`oc`).
* Log in to infrastructure cluster as a user with `cluster-admin` privileges..

.Procedure

. Run the following command to patch the `dns.operator/default` and ensure that the DNS Operator is scheduled on a {product-title} node with the label `node-role.kubernetes.io/master`:
+
[source,terminal]
----
$ oc patch dns.operator/default --type=merge --patch='{"spec":{"nodePlacement":{"nodeSelector":{"node-role.kubernetes.io/master":""}}}}'
----

. Run the following command to patch the `ingresscontroller/default` and ensure that the Ingress Operator is scheduled on a {product-title} node with the label `node-role.kubernetes.io/master`:
+
[source,terminal]
----
$ oc patch ingresscontroller/default --type=merge --patch='{"spec":{"nodePlacement":{"nodeSelector":{"matchLabels":{"node-role.kubernetes.io/master":""}}}}}' -n openshift-ingress-operator
----

. Disable monitoring on the worker nodes by following these steps:

.. Create the following YAML and save it in file named `monitor-patch-cm.yaml`:
+
[source,yaml]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: cluster-monitoring-config
  namespace: openshift-monitoring
data:
  config.yaml: |
    prometheusOperator:
      nodeSelector:
        node-role.kubernetes.io/master: ""
    prometheusK8s:
      nodeSelector:
        node-role.kubernetes.io/master: ""
    alertmanagerMain:
      nodeSelector:
        node-role.kubernetes.io/master: ""
    kubeStateMetrics:
      nodeSelector:
        node-role.kubernetes.io/master: ""
    grafana:
      nodeSelector:
        node-role.kubernetes.io/master: ""
    telemeterClient:
      nodeSelector:
        node-role.kubernetes.io/master: ""
    k8sPrometheusAdapter:
      nodeSelector:
        node-role.kubernetes.io/master: ""
    openshiftStateMetrics:
      nodeSelector:
       node-role.kubernetes.io/master: ""
    thanosQuerier:
      nodeSelector:
        node-role.kubernetes.io/master: ""
----

.. Run the following command:
+
[source,terminal]
----
$ oc create -f monitor-patch-cm.yaml
----